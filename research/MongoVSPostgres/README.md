# Исследование MongoDB

## Подготовка

Окружение поднимается и инициализируется при запуске docker-compose файла. Используйте команду

```bash
docker compose -f .\docker-compose.yaml up -d
```

для запуска окружения. При этом запустятся СУБД MongoDB и PostgreSQL с тестовой БД.

И MongoDB и PostgreSQL запущены в виде мини-кластера по 2 реплики (т.к. шардирование в PostgreSQL не идет "из коробки")
## Условия тестирования и тестовые данные

Для тестирования использовались 3 типа данных: рецензии, лайки и закладки. Их структура задаётся в файле models.py.

Тестировался следующий объём данных:

- Число пользователей: 10 000
- Число фильмов  100 000
- Количество лайков (фильмы + рецензии): 900 000
- Количество рецензий: 200 000
- Количество закладок: 100 000

Тестирование было выполнено на следующей конфигурации:

- CPU: Intel Core i5 12500H (12 ядер)
- RAM: 16gb DDR4
- SSD: 512gb 

## Запросы

Каждый запрос был выполнен по пять раз. Объём запрашиваемых данных был ограничен в 1000 записей.

Использовались следующие запросы:

- get_ratings: получение всех рейтингов.
- get_reviews: получение всех рецензий.
- get_rates: получений всех лайков и дизлайков.
- get_bookmarks: получение всех закладок.
- get_likes: получение лайков для фильмов (условие на равенство 10).
- get_dislikes: получение дизлайков для фильмов (условие на равенство 10).
- get_movies_with_top_ratings: получение фильмов с сортировкой по среднему рейтингу.

## Результаты

Тестирование и результаты со всеми этапами (генерацией данных, вставкой их в СУБД и проведение тестовых запросов) сохранены в формате Jupyter Notebook в файле ***Тестирование MongoDB.ipynb***. Ниже представлена таблица со сводными результатами (среднее время на выполнение запроса в секундах, округлённое до сотых):

| №    | Название запроса            | MongoDB    | PostgtreSQL | MongoDB/PostgreSQL в % |
| ---- |-----------------------------|------------|-------------|------------------------|
| 1    | get_ratings                 | 0.57       | 0.005       | 11400                  |
| 2    | get_reviews                 | 0.47       | 0.006       | 7800                   |
| 3    | get_rates                   | 0.65       | 0.004       | 16200                  |
| 4    | get_bookmarks               | 0.52       | 0.004       | 13000                  |
| 5    | get_likes                   | ** 0.54 ** | 0.64        | 84                     |
| 6    | get_dislikes                | ** 0.56 ** | 0.61        | 92                     |
| 7    | get_movies_with_top_ratings | 1.95       | 0.477       | 409                    |

## Выводы

В ходе тестирования производительность PostgreSQL оказалась быстрее, чем производительность MongoDB. В относительных величинах время запроса укладывалось в одну секунду в обоих базах данных в большинстве случаев

MongoDB показала лучшую производительность на запросах с условием к коллекции с наибольшим наполнением likes (900 000 записей). В остальных запросах производительней оказалась PostgreSQL.

Возможно, ускорить производительность MongoDB возможно, добавив шардирование (так как MongoDB изначально предполагает построение кластера), а также оптимизациями запросов.

