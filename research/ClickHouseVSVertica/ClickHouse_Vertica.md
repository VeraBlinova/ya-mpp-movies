# Сравнение хранилищ ClickHouse и Vertica

<br>Характеристики тестовой машины: i5 12500H (12 ядер), 16gb DDR4, 512gb SSD<br>

<b>ТЕОРИЯ</b><br>
Сперва изучем основные особенности двух продуктов.


<table>
<tbody>
<tr class="odd">
<td><b>Vertica</b></td>
<td><b>Clickhouse</b></td>
</tr>
<tr class="even">
<td>Появилось давно. Сложно добавить что-то новое в архитектуру.</td>
<td>Появилось недавно. Более гибкий инструмент.</td>
<tr class="even">
<td><p>2 режима работы для кластера vertica: <b>eon</b> и <b>enterprise</b>.</p>
<p><b>Eon</b> – когда данные храняться в одном месте (например в облаке), а воркеры на других серверах. Можно легко увеличивать или уменьшать кол-во нод.</p>
<p><b>Enterprise mode</b> - у каждого воркера хранятся свои данные (т.е. шардинг). Сложнее создавать новых воркеров.</p>
<td>Только один вариант кластера – шардинг. На каждой ноде хранятся данные.</td>
</tr>
<tr class="odd">
<td>Vertica умеет объединять контейнеры “из коробки”, это плюс, так как надежно.</td>
<td>Для синхронизации нод требуется zookeeper.</td>
</tr>
</tbody>
</table>

<b>ТЕСТИРОВАНИЕ</b><br>
Тестирование проводилось на одном узле
Представлено время на запросы к статичной БД в 10М записей (и к БД под постоянной нагрузкой)

| Операция                             | ClickHouse           | Vertica                | SQL запрос                           |
|--------------------------------------|----------------------|------------------------|--------------------------------------|
| Вставка 10M записей пачками по 10К   | 21.2 секунд          | 35.5 секунд            | Множественный INSERT INTO ... VALUES |
| Запрос всей таблицы выполнен         | 4.4 секунд (17.9 с)  | 52.15 секунд (209.4 с) | SELECT ALL  ...                      |
| Запрос уникальной записи             | 0.08 секунд (0.12 с) | 0.03 секунд (0.15 с)   | SELECT ... WHERE id = 1              |
| Запрос нескольких записей по условию | 0.15 секунд (0.48 с) | 0.4 секунд (2.38 с)    | SELECT ... WHERE year = 2000         |
| Запрос среднего по полю year         | 0.09 секунд (0.09 с) | 0.04 секунд (0.11 с)   | SELECT AVG(year) ...                 |
| Запрос с группировкой                | 0.16 секунд (0.19 с) | 0.61 секунд (1.47 с)   | SELECT ... GROUP BY genre            |


<b>Итог </b> <br>
Vertica платный, медленнее, более стабильный на данный момент продукт. <br>
<b>ClickHouse быстрее, бесплатный, но требует настройки. Для репликации требует Zookeeper.</b>